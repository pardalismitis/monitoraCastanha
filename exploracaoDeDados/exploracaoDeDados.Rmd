---
title: "Castanha"
author: "Fernando Lima, D.Sc."
output: html_notebook
---

```{r packages, include=FALSE}
rm(list = ls(all = TRUE))
#install.packages("here")
#install.packages("dplyr")
#install.packages("ggplot2")
library(here)
library(dplyr)
library(ggplot2)
```

```{r dataReading}
producaoCazumba = read.csv(here("data", "producao.csv"), sep = ";")
sementesCazumba = read.csv(here("data", "sementes.csv"), sep = ";")
```

```{r limpeza}
producaoCazumba$Castanhal <- gsub("Zirmao","Zirmão",producaoCazumba$Castanhal)
producaoCazumba$Castanhal <- gsub("Irmaos","Irmãos",producaoCazumba$Castanhal)

#unique(producaoCazumba$n_frutos_ouricos_produzidos)
```

```{r agregandoDados}

sementesSoma=group_by(sementesCazumba,Castanhal,Ano)

sementesAgregada = summarise(
    sementesSoma,
    total_sementes = sum(
        n_de_sementes_por_fruto_ourico,
        na.rm = TRUE
    ),
    media_sementes = mean(
        n_de_sementes_por_fruto_ourico,
        na.rm = TRUE
    ),
    peso_total = sum(
        Peso_total_das_sementes_dos_10.frutos_ouricos_Kg,
        na.rm = TRUE
    ),
    peso_semente=  peso_total/total_sementes
)

sementesAgregada=as.data.frame(sementesAgregada)

producaoSoma = group_by(producaoCazumba, Castanhal,Ano )

producaoAgregada = summarise(
    producaoSoma,
    total_frutos = sum(
        n_frutos_ouricos_produzidos,
        na.rm = TRUE
    )
)

producaoAgregada=as.data.frame(producaoAgregada)

producaototal = 
  producaoAgregada$total_frutos*
  sementesAgregada$media_sementes*
  sementesAgregada$peso_semente

producaototal=cbind.data.frame(producaototal,producaoAgregada$Castanhal,producaoAgregada$Ano)

```

```{r exportando}
sementesAgregada = as.data.frame(sementesAgregada)
producaoAgregada = as.data.frame(producaoAgregada)
write.csv(sementesAgregada, here("output", "sementesAgregadas.csv"))
write.csv(producaoAgregada, here("output", "producaoAgregada.csv"))
```

This is an [R Markdown](http://rmarkdown.rstudio.com) Notebook. When you execute code within the notebook, the results appear beneath the code.

Try executing this chunk by clicking the *Run* button within the chunk or by placing your cursor inside it and pressing *Ctrl+Shift+Enter*.


```{r plotSementes}
ggplot(sementesAgregada, aes(x=factor(Ano), y=media_sementes))+
  geom_bar(
    position = position_dodge2(preserve ="single"),
    stat="identity",
    width = 0.5,
    size =0.3,
    fill = "blue"
    )+
  
  theme_bw()+
  
  facet_wrap(facets = vars(Castanhal))+
  
  xlab("CASTANHAL")+
  
  ylab("MÉDIA DE SEMENTES")+
  
  theme(legend.position="top")+
  
  theme(axis.text.x = element_text(
    angle=45,
    vjust=1,
    hjust = 1,
    colour="black",
    size=rel(1))
    )
```


```{r plot}
ggplot(producaototal, aes(x=factor(producaoAgregada$Ano), y=producaototal))+
  geom_bar(
    position = position_dodge2(preserve ="single"),
    stat="identity",
    width = 0.5,
    size =0.3,
    fill = "blue"
    )+
  
  geom_text(
    aes(label= as.integer(producaototal)),
    size = 3,
    vjust = -0.5
    )+
  
  ylim(0,1800)+
  
  theme_bw()+
  
  facet_wrap(facets = vars(producaoAgregada$Castanhal))+
  
  xlab("PRODUÇÃO ESTIMADA")+
  
  ylab("PRODUÇÃO TOTAL (Kg)")+
  
  theme(legend.position="top")+
  
  theme(axis.text.x = element_text(
    angle=45,
    vjust=1,
    hjust = 1,
    colour="black",
    size=rel(1))
    )
```
Add a new chunk by clicking the *Insert Chunk* button on the toolbar or by pressing *Ctrl+Alt+I*.

When you save the notebook, an HTML file containing the code and output will be saved alongside it (click the *Preview* button or press *Ctrl+Shift+K* to preview the HTML file).

The preview shows you a rendered HTML copy of the contents of the editor. Consequently, unlike *Knit*, *Preview* does not run any R code chunks. Instead, the output of the chunk when it was last run in the editor is displayed.